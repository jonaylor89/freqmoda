<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AI Audio Engineer Demo</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
        <!-- PostHog Analytics -->
        {% if posthog_api_key.is_some() && posthog_host.is_some() %}
        <script>
            !(function (t, e) {
                var o, n, p, r;
                e.__SV ||
                    ((window.posthog = e),
                    (e._i = []),
                    (e.init = function (i, s, a) {
                        function g(t, e) {
                            var o = e.split(".");
                            2 == o.length && ((t = t[o[0]]), (e = o[1]));
                            var n = t;
                            if ("undefined" != typeof n[e])
                                return (
                                    (n[e] = function () {
                                        n.push(
                                            [e].concat(
                                                Array.prototype.slice.call(
                                                    arguments,
                                                    0,
                                                ),
                                            ),
                                        );
                                    }),
                                    n
                                );
                        }
                        ((p = t.createElement("script")).type =
                            "text/javascript"),
                            (p.async = !0),
                            (p.src = s.api_host + "/static/array.js"),
                            (r =
                                t.getElementsByTagName(
                                    "script",
                                )[0]).parentNode.insertBefore(p, r);
                        var u = e;
                        for (
                            void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                                u.people = u.people || [],
                                u.toString = function (t) {
                                    var e = "posthog";
                                    return (
                                        "posthog" !== a && (e += "." + a),
                                        t || (e += " (stub)"),
                                        e
                                    );
                                },
                                u.people.toString = function () {
                                    return u.toString(1) + ".people (stub)";
                                },
                                o =
                                    "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(
                                        " ",
                                    ),
                                n = 0;
                            n < o.length;
                            n++
                        )
                            g(u, o[n]);
                        e._i.push([i, s, a]);
                    }),
                    (e.__SV = 1));
            })(document, window.posthog || []);
            posthog.init("{{ posthog_api_key.as_ref().unwrap() }}", {
                api_host: "/relay-TVmB",
                person_profiles: "identified_only",
            });
        </script>
        {% endif %}

        <!-- Custom CSS for specific functionality -->
        <style>
            .modal-overlay {
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
            }
            .glass {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
            .btn-primary {
                background: linear-gradient(135deg, #6366f1, #4f46e5);
            }
            .btn-primary:hover {
                background: linear-gradient(135deg, #4f46e5, #3730a3);
                transform: translateY(-1px);
            }
            .btn-secondary {
                background: linear-gradient(135deg, #10b981, #059669);
            }
            .btn-secondary:hover {
                background: linear-gradient(135deg, #059669, #047857);
                transform: translateY(-1px);
            }
        </style>
    </head>
    <body
        class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen"
    >
        <!-- Info Modal -->
        <div
            id="infoModal"
            class="fixed inset-0 modal-overlay flex items-center justify-center z-50"
        >
            <div class="glass max-w-lg w-full mx-4 p-8 rounded-xl shadow-2xl">
                <div class="text-center space-y-4">
                    <div
                        class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl mx-auto flex items-center justify-center text-white"
                    >
                        <i data-lucide="music" class="w-8 h-8"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">
                        AI Audio Engineer Demo
                    </h2>
                    <p class="text-gray-600 leading-relaxed">
                        This demo allows you to process audio files using
                        natural language commands. Select any sample from the
                        table below and click "Edit" to open the AI chat
                        interface where you can describe how you want to
                        transform the audio.
                    </p>
                    <button
                        onclick="closeInfoModal()"
                        class="btn-primary text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 w-full"
                    >
                        Get Started
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <div
                        class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white"
                    >
                        <i data-lucide="music" class="w-6 h-6"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900">
                        AI Audio Engineer Demo
                    </h1>
                </div>
                <p class="text-gray-600">
                    Transform audio files using natural language commands
                </p>
            </div>

            <!-- Samples Table -->
            <div class="glass rounded-xl shadow-xl overflow-hidden">
                {% if samples.is_empty() %}
                <!-- Empty State -->
                <div class="p-12 text-center">
                    <div
                        class="w-16 h-16 bg-gray-100 rounded-xl mx-auto mb-4 flex items-center justify-center"
                    >
                        <i
                            data-lucide="folder"
                            class="w-8 h-8 text-gray-400"
                        ></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">
                        No Samples Available
                    </h3>
                    <p class="text-gray-600 mb-4">
                        Audio samples are being prepared. Please check back
                        later.
                    </p>
                    <button
                        onclick="trackRefreshClick(); window.location.reload()"
                        class="btn-secondary text-white px-4 py-2 rounded-lg font-medium transition-all duration-300"
                    >
                        <i
                            data-lucide="refresh-cw"
                            class="w-4 h-4 inline mr-2"
                        ></i>
                        Refresh
                    </button>
                </div>
                {% else %}
                <!-- Table Header -->
                <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                    <div
                        class="grid grid-cols-12 gap-4 font-medium text-gray-700 text-sm"
                    >
                        <div class="col-span-4 md:col-span-4">Sample Name</div>
                        <div class="col-span-2 hidden md:block">Type</div>
                        <div class="col-span-2 hidden md:block">Duration</div>
                        <div class="col-span-3 hidden md:block">Sample Key</div>
                        <div class="col-span-8 md:col-span-1">Action</div>
                    </div>
                </div>

                <!-- Table Body -->
                <div class="divide-y divide-gray-200">
                    {% for sample in samples %}
                    <div
                        class="px-6 py-4 hover:bg-gray-50 transition-colors duration-200"
                    >
                        <div class="grid grid-cols-12 gap-4 items-center">
                            <!-- Sample Name -->
                            <div class="col-span-4 md:col-span-4">
                                <h3
                                    class="font-semibold text-gray-900 truncate"
                                >
                                    {{ sample.title }}
                                </h3>
                            </div>

                            <!-- File Type -->
                            <div class="col-span-2 hidden md:block">
                                <span
                                    class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                                >
                                    {{ sample.file_type }}
                                </span>
                            </div>

                            <!-- Duration -->
                            <div class="col-span-2 hidden md:block">
                                <span class="text-sm text-gray-600 font-mono">
                                    {% match sample.duration %} {% when Some
                                    with (duration) %} {{ duration }}s {% when
                                    None %} -- {% endmatch %}
                                </span>
                            </div>

                            <!-- Sample Key -->
                            <div class="col-span-3 hidden md:block">
                                <code
                                    class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-700"
                                >
                                    {{ sample.streaming_key }}
                                </code>
                            </div>

                            <!-- Action -->
                            <div class="col-span-8 md:col-span-1">
                                <a
                                    href="/sample/{{ sample.streaming_key }}"
                                    class="btn-secondary text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 inline-flex items-center space-x-1 w-full md:w-auto justify-center"
                                    onclick="trackSampleClick('{{ sample.streaming_key }}', '{{ sample.title }}')"
                                >
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                    <span>Edit</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 text-gray-500 text-sm">
                <p>AI Audio Engineer Demo</p>
            </div>
        </div>

        <script>
            function closeInfoModal() {
                document.getElementById("infoModal").style.display = "none";
                localStorage.setItem("audioEngineeerDemoVisited", "true");

                // Track modal interaction
                {% if posthog_api_key.is_some() %}
                if (typeof posthog !== 'undefined') {
                    posthog.capture('info_modal_closed', {
                        source: 'button_click'
                    });
                }
                {% endif %}
            }

            // Show modal only on first visit
            document.addEventListener("DOMContentLoaded", function () {
                lucide.createIcons();

                const hasVisited = localStorage.getItem(
                    "audioEngineeerDemoVisited",
                );
                if (!hasVisited) {
                    document.getElementById("infoModal").style.display = "flex";

                    // Track modal shown
                    {% if posthog_api_key.is_some() %}
                    if (typeof posthog !== 'undefined') {
                        posthog.capture('info_modal_shown', {
                            is_first_visit: true
                        });
                    }
                    {% endif %}
                } else {
                    document.getElementById("infoModal").style.display = "none";
                }

                // Track page view
                {% if posthog_api_key.is_some() %}
                if (typeof posthog !== 'undefined') {
                    posthog.capture('$pageview', {
                        page: 'index',
                        samples_count: {{ samples.len() }}
                    });
                }
                {% endif %}
            });

            // Close modal on background click
            document
                .getElementById("infoModal")
                .addEventListener("click", function (e) {
                    if (e.target === this) {
                        closeInfoModal();

                        // Track modal interaction
                        {% if posthog_api_key.is_some() %}
                        if (typeof posthog !== 'undefined') {
                            posthog.capture('info_modal_closed', {
                                source: 'background_click'
                            });
                        }
                        {% endif %}
                    }
                });

            // Close modal on escape key
            document.addEventListener("keydown", function (e) {
                if (e.key === "Escape") {
                    closeInfoModal();

                    // Track modal interaction
                    {% if posthog_api_key.is_some() %}
                    if (typeof posthog !== 'undefined') {
                        posthog.capture('info_modal_closed', {
                            source: 'escape_key'
                        });
                    }
                    {% endif %}
                }
            });

            // Track sample selection clicks
            function trackSampleClick(sampleKey, sampleTitle) {
                {% if posthog_api_key.is_some() %}
                if (typeof posthog !== 'undefined') {
                    posthog.capture('sample_selected', {
                        sample_key: sampleKey,
                        sample_title: sampleTitle
                    });
                }
                {% endif %}
            }

            // Track refresh button clicks
            function trackRefreshClick() {
                {% if posthog_api_key.is_some() %}
                if (typeof posthog !== 'undefined') {
                    posthog.capture('refresh_samples_clicked');
                }
                {% endif %}
            }
        </script>
    </body>
</html>
